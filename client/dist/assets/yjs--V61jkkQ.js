import{a as ge}from"./@emotion/react-FoiRykrP.js";import{O as mn,G as B,s as G,H as M,u as mt,I as L,b as _t,J as xe,K as lt,L as Ut,M as Wt,N as _n,P as Sn,Q as yn,R as pe,S as vt,T as we,U as Nt,V as Lt,W as V,X as F,Y as et,Z as Vt,_ as Ft,$ as ke,D as zt,a0 as bn,w as m,e as A,t as N,a1 as Re,q as Xt,y as qt,a2 as Dn,d as Cn,a3 as Bt,a4 as En,c as ne,p as Jt,x as Mt,v as Z,a5 as An,r as k,a6 as jt,h as I,a7 as Ht,a8 as me,E as Qt,a9 as In,o as Zt,aa as Ln,k as Gt}from"./y-monaco-NBPYL57F.js";import{c as _e,u as Mn,a as On,p as Tn,R as xn,U as Rn,B as Un,O as vn,b as Nn}from"./y-webrtc-AYxHyzJE.js";const Ue=s=>({[Symbol.iterator](){return this},next:s}),Vn=(s,t)=>Ue(()=>{let e;do e=s.next();while(!e.done&&!t(e.value));return e}),Yt=(s,t)=>Ue(()=>{const{done:e,value:n}=s.next();return{done:e,value:e?void 0:t(n)}});class se{constructor(t,e){this.clock=t,this.len=e}}class ct{constructor(){this.clients=new Map}}const ve=(s,t,e)=>t.clients.forEach((n,r)=>{const i=s.doc.store.clients.get(r);for(let l=0;l<n.length;l++){const c=n[l];Xe(s,i,c.clock,c.len,e)}}),Fn=(s,t)=>{let e=0,n=s.length-1;for(;e<=n;){const r=qt((e+n)/2),i=s[r],l=i.clock;if(l<=t){if(t<l+i.len)return r;e=r+1}else n=r-1}return null},Ne=(s,t)=>{const e=s.clients.get(t.client);return e!==void 0&&Fn(e,t.clock)!==null},re=s=>{s.clients.forEach(t=>{t.sort((r,i)=>r.clock-i.clock);let e,n;for(e=1,n=1;e<t.length;e++){const r=t[n-1],i=t[e];r.clock+r.len>=i.clock?r.len=lt(r.len,i.clock+i.len-r.clock):(n<e&&(t[n]=i),n++)}t.length=n})},Bn=s=>{const t=new ct;for(let e=0;e<s.length;e++)s[e].clients.forEach((n,r)=>{if(!t.clients.has(r)){const i=n.slice();for(let l=e+1;l<s.length;l++)An(i,s[l].clients.get(r)||[]);t.clients.set(r,i)}});return re(t),t},St=(s,t,e,n)=>{G(s.clients,t,()=>[]).push(new se(e,n))},Jn=()=>new ct,jn=s=>{const t=Jn();return s.clients.forEach((e,n)=>{const r=[];for(let i=0;i<e.length;i++){const l=e[i];if(l.deleted){const c=l.id.clock;let o=l.length;if(i+1<e.length)for(let a=e[i+1];i+1<e.length&&a.deleted;a=e[++i+1])o+=a.length;r.push(new se(c,o))}}r.length>0&&t.clients.set(n,r)}),t},P=(s,t)=>{m(s.restEncoder,t.clients.size),B(t.clients.entries()).sort((e,n)=>n[0]-e[0]).forEach(([e,n])=>{s.resetDsCurVal(),m(s.restEncoder,e);const r=n.length;m(s.restEncoder,r);for(let i=0;i<r;i++){const l=n[i];s.writeDsClock(l.clock),s.writeDsLen(l.len)}})},ie=s=>{const t=new ct,e=k(s.restDecoder);for(let n=0;n<e;n++){s.resetDsCurVal();const r=k(s.restDecoder),i=k(s.restDecoder);if(i>0){const l=G(t.clients,r,()=>[]);for(let c=0;c<i;c++)l.push(new se(s.readDsClock(),s.readDsLen()))}}return t},Se=(s,t,e)=>{const n=new ct,r=k(s.restDecoder);for(let i=0;i<r;i++){s.resetDsCurVal();const l=k(s.restDecoder),c=k(s.restDecoder),o=e.clients.get(l)||[],a=y(e,l);for(let h=0;h<c;h++){const d=s.readDsClock(),u=d+s.readDsLen();if(d<a){a<u&&St(n,l,a,u-a);let f=O(o,d),g=o[f];for(!g.deleted&&g.id.clock<d&&(o.splice(f+1,0,It(t,g,d-g.id.clock)),f++);f<o.length&&(g=o[f++],g.id.clock<u);)g.deleted||(u<g.id.clock+g.length&&o.splice(f,0,It(t,g,u-g.id.clock)),g.delete(t))}else St(n,l,d,u-d)}}if(n.clients.size>0){const i=new J;return m(i.restEncoder,0),P(i,n),i.toUint8Array()}return null},Ve=On;class ot extends mn{constructor({guid:t=Mn(),collectionid:e=null,gc:n=!0,gcFilter:r=()=>!0,meta:i=null,autoLoad:l=!1,shouldLoad:c=!0}={}){super(),this.gc=n,this.gcFilter=r,this.clientID=Ve(),this.guid=t,this.collectionid=e,this.share=new Map,this.store=new We,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=c,this.autoLoad=l,this.meta=i,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=_e(a=>{this.on("load",()=>{this.isLoaded=!0,a(this)})});const o=()=>_e(a=>{const h=d=>{(d===void 0||d===!0)&&(this.off("sync",h),a())};this.on("sync",h)});this.on("sync",a=>{a===!1&&this.isSynced&&(this.whenSynced=o()),this.isSynced=a===void 0||a===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[])}),this.whenSynced=o()}load(){const t=this._item;t!==null&&!this.shouldLoad&&_(t.parent.doc,e=>{e.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(B(this.subdocs).map(t=>t.guid))}transact(t,e=null){return _(this,t,e)}get(t,e=D){const n=G(this.share,t,()=>{const i=new e;return i._integrate(this,null),i}),r=n.constructor;if(e!==D&&r!==e)if(r===D){const i=new e;i._map=n._map,n._map.forEach(l=>{for(;l!==null;l=l.left)l.parent=i}),i._start=n._start;for(let l=i._start;l!==null;l=l.right)l.parent=i;return i._length=n._length,this.share.set(t,i),i._integrate(this,null),i}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return n}getArray(t=""){return this.get(t,z)}getText(t=""){return this.get(t,Q)}getMap(t=""){return this.get(t,q)}getXmlFragment(t=""){return this.get(t,j)}toJSON(){const t={};return this.share.forEach((e,n)=>{t[n]=e.toJSON()}),t}destroy(){B(this.subdocs).forEach(e=>e.destroy());const t=this._item;if(t!==null){this._item=null;const e=t.content;e.doc=new ot({guid:this.guid,...e.opts,shouldLoad:!1}),e.doc._item=t,_(t.parent.doc,n=>{const r=e.doc;t.deleted||n.subdocsAdded.add(r),n.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}on(t,e){super.on(t,e)}off(t,e){super.off(t,e)}}class Fe{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return k(this.restDecoder)}readDsLen(){return k(this.restDecoder)}}class Be extends Fe{readLeftID(){return p(k(this.restDecoder),k(this.restDecoder))}readRightID(){return p(k(this.restDecoder),k(this.restDecoder))}readClient(){return k(this.restDecoder)}readInfo(){return Qt(this.restDecoder)}readString(){return Gt(this.restDecoder)}readParentInfo(){return k(this.restDecoder)===1}readTypeRef(){return k(this.restDecoder)}readLen(){return k(this.restDecoder)}readAny(){return Zt(this.restDecoder)}readBuf(){return Nn(I(this.restDecoder))}readJSON(){return JSON.parse(Gt(this.restDecoder))}readKey(){return Gt(this.restDecoder)}}class Hn{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=k(this.restDecoder),this.dsCurrVal}readDsLen(){const t=k(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class X extends Hn{constructor(t){super(t),this.keys=[],k(t),this.keyClockDecoder=new jt(I(t)),this.clientDecoder=new Ht(I(t)),this.leftClockDecoder=new jt(I(t)),this.rightClockDecoder=new jt(I(t)),this.infoDecoder=new me(I(t),Qt),this.stringDecoder=new In(I(t)),this.parentInfoDecoder=new me(I(t),Qt),this.typeRefDecoder=new Ht(I(t)),this.lenDecoder=new Ht(I(t))}readLeftID(){return new W(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new W(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return Zt(this.restDecoder)}readBuf(){return I(this.restDecoder)}readJSON(){return Zt(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const e=this.stringDecoder.read();return this.keys.push(e),e}}}class Je{constructor(){this.restEncoder=Mt()}toUint8Array(){return N(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){m(this.restEncoder,t)}writeDsLen(t){m(this.restEncoder,t)}}class ht extends Je{writeLeftID(t){m(this.restEncoder,t.client),m(this.restEncoder,t.clock)}writeRightID(t){m(this.restEncoder,t.client),m(this.restEncoder,t.clock)}writeClient(t){m(this.restEncoder,t)}writeInfo(t){zt(this.restEncoder,t)}writeString(t){Jt(this.restEncoder,t)}writeParentInfo(t){m(this.restEncoder,t?1:0)}writeTypeRef(t){m(this.restEncoder,t)}writeLen(t){m(this.restEncoder,t)}writeAny(t){Xt(this.restEncoder,t)}writeBuf(t){A(this.restEncoder,t)}writeJSON(t){Jt(this.restEncoder,JSON.stringify(t))}writeKey(t){Jt(this.restEncoder,t)}}class je{constructor(){this.restEncoder=Mt(),this.dsCurrVal=0}toUint8Array(){return N(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const e=t-this.dsCurrVal;this.dsCurrVal=t,m(this.restEncoder,e)}writeDsLen(t){t===0&&L(),m(this.restEncoder,t-1),this.dsCurrVal+=t}}class J extends je{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Vt,this.clientEncoder=new Ft,this.leftClockEncoder=new Vt,this.rightClockEncoder=new Vt,this.infoEncoder=new ke(zt),this.stringEncoder=new bn,this.parentInfoEncoder=new ke(zt),this.typeRefEncoder=new Ft,this.lenEncoder=new Ft}toUint8Array(){const t=Mt();return m(t,0),A(t,this.keyClockEncoder.toUint8Array()),A(t,this.clientEncoder.toUint8Array()),A(t,this.leftClockEncoder.toUint8Array()),A(t,this.rightClockEncoder.toUint8Array()),A(t,N(this.infoEncoder)),A(t,this.stringEncoder.toUint8Array()),A(t,N(this.parentInfoEncoder)),A(t,this.typeRefEncoder.toUint8Array()),A(t,this.lenEncoder.toUint8Array()),Re(t,N(this.restEncoder)),N(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){Xt(this.restEncoder,t)}writeBuf(t){A(this.restEncoder,t)}writeJSON(t){Xt(this.restEncoder,t)}writeKey(t){const e=this.keyMap.get(t);e===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(e)}}const Gn=(s,t,e,n)=>{n=lt(n,t[0].id.clock);const r=O(t,n);m(s.restEncoder,t.length-r),s.writeClient(e),m(s.restEncoder,n);const i=t[r];i.write(s,n-i.id.clock);for(let l=r+1;l<t.length;l++)t[l].write(s,0)},le=(s,t,e)=>{const n=new Map;e.forEach((r,i)=>{y(t,i)>r&&n.set(i,r)}),Ot(t).forEach((r,i)=>{e.has(i)||n.set(i,0)}),m(s.restEncoder,n.size),B(n.entries()).sort((r,i)=>i[0]-r[0]).forEach(([r,i])=>{Gn(s,t.clients.get(r),r,i)})},Yn=(s,t)=>{const e=ne(),n=k(s.restDecoder);for(let r=0;r<n;r++){const i=k(s.restDecoder),l=new Array(i),c=s.readClient();let o=k(s.restDecoder);e.set(c,{i:0,refs:l});for(let a=0;a<i;a++){const h=s.readInfo();switch(Lt&h){case 0:{const d=s.readLen();l[a]=new C(p(c,o),d),o+=d;break}case 10:{const d=k(s.restDecoder);l[a]=new E(p(c,o),d),o+=d;break}default:{const d=(h&(F|V))===0,u=new S(p(c,o),null,(h&V)===V?s.readLeftID():null,null,(h&F)===F?s.readRightID():null,d?s.readParentInfo()?t.get(s.readString()):s.readLeftID():null,d&&(h&et)===et?s.readString():null,pn(s,h));l[a]=u,o+=u.length}}}}return e},$n=(s,t,e)=>{const n=[];let r=B(e.keys()).sort((f,g)=>f-g);if(r.length===0)return null;const i=()=>{if(r.length===0)return null;let f=e.get(r[r.length-1]);for(;f.refs.length===f.i;)if(r.pop(),r.length>0)f=e.get(r[r.length-1]);else return null;return f};let l=i();if(l===null)return null;const c=new We,o=new Map,a=(f,g)=>{const w=o.get(f);(w==null||w>g)&&o.set(f,g)};let h=l.refs[l.i++];const d=new Map,u=()=>{for(const f of n){const g=f.id.client,w=e.get(g);w?(w.i--,c.clients.set(g,w.refs.slice(w.i)),e.delete(g),w.i=0,w.refs=[]):c.clients.set(g,[f]),r=r.filter($=>$!==g)}n.length=0};for(;;){if(h.constructor!==E){const g=G(d,h.id.client,()=>y(t,h.id.client))-h.id.clock;if(g<0)n.push(h),a(h.id.client,h.id.clock-1),u();else{const w=h.getMissing(s,t);if(w!==null){n.push(h);const $=e.get(w)||{refs:[],i:0};if($.refs.length===$.i)a(w,y(t,w)),u();else{h=$.refs[$.i++];continue}}else(g===0||g<h.length)&&(h.integrate(s,g),d.set(h.id.client,h.id.clock+h.length))}}if(n.length>0)h=n.pop();else if(l!==null&&l.i<l.refs.length)h=l.refs[l.i++];else{if(l=i(),l===null)break;h=l.refs[l.i++]}}if(c.clients.size>0){const f=new J;return le(f,c,new Map),m(f.restEncoder,0),{missing:o,update:f.toUint8Array()}}return null},Kn=(s,t)=>le(s,t.doc.store,t.beforeState),Wn=(s,t,e,n=new X(s))=>_(t,r=>{r.local=!1;let i=!1;const l=r.doc,c=l.store,o=Yn(n,l),a=$n(r,c,o),h=c.pendingStructs;if(h){for(const[u,f]of h.missing)if(f<y(c,u)){i=!0;break}if(a){for(const[u,f]of a.missing){const g=h.missing.get(u);(g==null||g>f)&&h.missing.set(u,f)}h.update=yt([h.update,a.update])}}else c.pendingStructs=a;const d=Se(n,r,c);if(c.pendingDs){const u=new X(Z(c.pendingDs));k(u.restDecoder);const f=Se(u,r,c);d&&f?c.pendingDs=yt([d,f]):c.pendingDs=d||f}else c.pendingDs=d;if(i){const u=c.pendingStructs.update;c.pendingStructs=null,He(r.doc,u)}},e,!1),He=(s,t,e,n=X)=>{const r=Z(t);Wn(r,s,e,new n(r))},rr=(s,t,e)=>He(s,t,e,Be),zn=(s,t,e=new Map)=>{le(s,t.store,e),P(s,jn(t.store))},Xn=(s,t=new Uint8Array([0]),e=new J)=>{const n=Ge(t);zn(e,s,n);const r=[e.toUint8Array()];if(s.store.pendingDs&&r.push(s.store.pendingDs),s.store.pendingStructs&&r.push(ds(s.store.pendingStructs.update,t)),r.length>1){if(e.constructor===ht)return hs(r.map((i,l)=>l===0?i:fs(i)));if(e.constructor===J)return yt(r)}return r[0]},ir=(s,t)=>Xn(s,t,new ht),qn=s=>{const t=new Map,e=k(s.restDecoder);for(let n=0;n<e;n++){const r=k(s.restDecoder),i=k(s.restDecoder);t.set(r,i)}return t},Ge=s=>qn(new Fe(Z(s))),Ye=(s,t)=>(m(s.restEncoder,t.size),B(t.entries()).sort((e,n)=>n[0]-e[0]).forEach(([e,n])=>{m(s.restEncoder,e),m(s.restEncoder,n)}),s),Qn=(s,t)=>Ye(s,Ot(t.store)),Zn=(s,t=new je)=>(s instanceof Map?Ye(t,s):Qn(t,s),t.toUint8Array()),lr=s=>Zn(s,new Je);class Pn{constructor(){this.l=[]}}const ye=()=>new Pn,be=(s,t)=>s.l.push(t),De=(s,t)=>{const e=s.l,n=e.length;s.l=e.filter(r=>t!==r),n===s.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},$e=(s,t,e)=>xe(s.l,[t,e]);class W{constructor(t,e){this.client=t,this.clock=e}}const ut=(s,t)=>s===t||s!==null&&t!==null&&s.client===t.client&&s.clock===t.clock,p=(s,t)=>new W(s,t),Ke=s=>{for(const[t,e]of s.doc.share.entries())if(e===s)return t;throw L()};class ts{constructor(t,e,n,r=0){this.type=t,this.tname=e,this.item=n,this.assoc=r}}class es{constructor(t,e,n=0){this.type=t,this.index=e,this.assoc=n}}const ns=(s,t,e=0)=>new es(s,t,e),ft=(s,t,e)=>{let n=null,r=null;return s._item===null?r=Ke(s):n=p(s._item.id.client,s._item.id.clock),new ts(n,r,t,e)},cr=(s,t,e=0)=>{let n=s._start;if(e<0){if(t===0)return ft(s,null,e);t--}for(;n!==null;){if(!n.deleted&&n.countable){if(n.length>t)return ft(s,p(n.id.client,n.id.clock+t),e);t-=n.length}if(n.right===null&&e<0)return ft(s,n.lastId,e);n=n.right}return ft(s,null,e)},or=(s,t)=>{const e=t.store,n=s.item,r=s.type,i=s.tname,l=s.assoc;let c=null,o=0;if(n!==null){if(y(e,n.client)<=n.clock)return null;const a=Te(e,n),h=a.item;if(!(h instanceof S))return null;if(c=h.parent,c._item===null||!c._item.deleted){o=h.deleted||!h.countable?0:a.diff+(l>=0?0:1);let d=h.left;for(;d!==null;)!d.deleted&&d.countable&&(o+=d.length),d=d.left}}else{if(i!==null)c=t.get(i);else if(r!==null){if(y(e,r.client)<=r.clock)return null;const{item:a}=Te(e,r);if(a instanceof S&&a.content instanceof x)c=a.content.type;else return null}else throw L();l>=0?o=c._length:o=0}return ns(c,o,s.assoc)},K=(s,t)=>t===void 0?!s.deleted:t.sv.has(s.id.client)&&(t.sv.get(s.id.client)||0)>s.id.clock&&!Ne(t.ds,s.id),Pt=(s,t)=>{const e=G(s.meta,Pt,_t),n=s.doc.store;e.has(t)||(t.sv.forEach((r,i)=>{r<y(n,i)&&v(s,p(i,r))}),ve(s,t.ds,r=>{}),e.add(t))};class We{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Ot=s=>{const t=new Map;return s.clients.forEach((e,n)=>{const r=e[e.length-1];t.set(n,r.id.clock+r.length)}),t},y=(s,t)=>{const e=s.clients.get(t);if(e===void 0)return 0;const n=e[e.length-1];return n.id.clock+n.length},ze=(s,t)=>{let e=s.clients.get(t.id.client);if(e===void 0)e=[],s.clients.set(t.id.client,e);else{const n=e[e.length-1];if(n.id.clock+n.length!==t.id.clock)throw L()}e.push(t)},O=(s,t)=>{let e=0,n=s.length-1,r=s[n],i=r.id.clock;if(i===t)return n;let l=qt(t/(i+r.length-1)*n);for(;e<=n;){if(r=s[l],i=r.id.clock,i<=t){if(t<i+r.length)return l;e=l+1}else n=l-1;l=qt((e+n)/2)}throw L()},ss=(s,t)=>{const e=s.clients.get(t.client);return e[O(e,t.clock)]},wt=ss,te=(s,t,e)=>{const n=O(t,e),r=t[n];return r.id.clock<e&&r instanceof S?(t.splice(n+1,0,It(s,r,e-r.id.clock)),n+1):n},v=(s,t)=>{const e=s.doc.store.clients.get(t.client);return e[te(s,e,t.clock)]},Ce=(s,t,e)=>{const n=t.clients.get(e.client),r=O(n,e.clock),i=n[r];return e.clock!==i.id.clock+i.length-1&&i.constructor!==C&&n.splice(r+1,0,It(s,i,e.clock-i.id.clock+1)),i},rs=(s,t,e)=>{const n=s.clients.get(t.id.client);n[O(n,t.id.clock)]=e},Xe=(s,t,e,n,r)=>{if(n===0)return;const i=e+n;let l=te(s,t,e),c;do c=t[l++],i<c.id.clock+c.length&&te(s,t,i),r(c);while(l<t.length&&t[l].id.clock<i)};class is{constructor(t,e,n){this.doc=t,this.deleteSet=new ct,this.beforeState=Ot(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=e,this.meta=new Map,this.local=n,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const Ee=(s,t)=>t.deleteSet.clients.size===0&&!Dn(t.afterState,(e,n)=>t.beforeState.get(n)!==e)?!1:(re(t.deleteSet),Kn(s,t),P(s,t.deleteSet),!0),Ae=(s,t,e)=>{const n=t._item;(n===null||n.id.clock<(s.beforeState.get(n.id.client)||0)&&!n.deleted)&&G(s.changed,t,_t).add(e)},kt=(s,t)=>{let e=s[t],n=s[t-1],r=t;for(;r>0;e=n,n=s[--r-1]){if(n.deleted===e.deleted&&n.constructor===e.constructor&&n.mergeWith(e)){e instanceof S&&e.parentSub!==null&&e.parent._map.get(e.parentSub)===e&&e.parent._map.set(e.parentSub,n);continue}break}const i=t-r;return i&&s.splice(t+1-i,i),i},ls=(s,t,e)=>{for(const[n,r]of s.clients.entries()){const i=t.clients.get(n);for(let l=r.length-1;l>=0;l--){const c=r[l],o=c.clock+c.len;for(let a=O(i,c.clock),h=i[a];a<i.length&&h.id.clock<o;h=i[++a]){const d=i[a];if(c.clock+c.len<=d.id.clock)break;d instanceof S&&d.deleted&&!d.keep&&e(d)&&d.gc(t,!1)}}}},cs=(s,t)=>{s.clients.forEach((e,n)=>{const r=t.clients.get(n);for(let i=e.length-1;i>=0;i--){const l=e[i],c=Cn(r.length-1,1+O(r,l.clock+l.len-1));for(let o=c,a=r[o];o>0&&a.id.clock>=l.clock;a=r[o])o-=1+kt(r,o)}})},qe=(s,t)=>{if(t<s.length){const e=s[t],n=e.doc,r=n.store,i=e.deleteSet,l=e._mergeStructs;try{re(i),e.afterState=Ot(e.doc.store),n.emit("beforeObserverCalls",[e,n]);const c=[];e.changed.forEach((o,a)=>c.push(()=>{(a._item===null||!a._item.deleted)&&a._callObserver(e,o)})),c.push(()=>{e.changedParentTypes.forEach((o,a)=>{a._dEH.l.length>0&&(a._item===null||!a._item.deleted)&&(o=o.filter(h=>h.target._item===null||!h.target._item.deleted),o.forEach(h=>{h.currentTarget=a,h._path=null}),o.sort((h,d)=>h.path.length-d.path.length),$e(a._dEH,o,e))})}),c.push(()=>n.emit("afterTransaction",[e,n])),xe(c,[]),e._needFormattingCleanup&&Is(e)}finally{n.gc&&ls(i,r,n.gcFilter),cs(i,r),e.afterState.forEach((h,d)=>{const u=e.beforeState.get(d)||0;if(u!==h){const f=r.clients.get(d),g=lt(O(f,u),1);for(let w=f.length-1;w>=g;)w-=1+kt(f,w)}});for(let h=l.length-1;h>=0;h--){const{client:d,clock:u}=l[h].id,f=r.clients.get(d),g=O(f,u);g+1<f.length&&kt(f,g+1)>1||g>0&&kt(f,g)}if(!e.local&&e.afterState.get(n.clientID)!==e.beforeState.get(n.clientID)&&(Tn(vn,Un,"[yjs] ",Rn,xn,"Changed the client-id because another client seems to be using it."),n.clientID=Ve()),n.emit("afterTransactionCleanup",[e,n]),n._observers.has("update")){const h=new ht;Ee(h,e)&&n.emit("update",[h.toUint8Array(),e.origin,n,e])}if(n._observers.has("updateV2")){const h=new J;Ee(h,e)&&n.emit("updateV2",[h.toUint8Array(),e.origin,n,e])}const{subdocsAdded:c,subdocsLoaded:o,subdocsRemoved:a}=e;(c.size>0||a.size>0||o.size>0)&&(c.forEach(h=>{h.clientID=n.clientID,h.collectionid==null&&(h.collectionid=n.collectionid),n.subdocs.add(h)}),a.forEach(h=>n.subdocs.delete(h)),n.emit("subdocs",[{loaded:o,added:c,removed:a},n,e]),a.forEach(h=>h.destroy())),s.length<=t+1?(n._transactionCleanups=[],n.emit("afterAllTransactions",[n,s])):qe(s,t+1)}}},_=(s,t,e=null,n=!0)=>{const r=s._transactionCleanups;let i=!1,l=null;s._transaction===null&&(i=!0,s._transaction=new is(s,e,n),r.push(s._transaction),r.length===1&&s.emit("beforeAllTransactions",[s]),s.emit("beforeTransaction",[s._transaction,s]));try{l=t(s._transaction)}finally{if(i){const c=s._transaction===r[0];s._transaction=null,c&&qe(r,0)}}return l};function*os(s){const t=k(s.restDecoder);for(let e=0;e<t;e++){const n=k(s.restDecoder),r=s.readClient();let i=k(s.restDecoder);for(let l=0;l<n;l++){const c=s.readInfo();if(c===10){const o=k(s.restDecoder);yield new E(p(r,i),o),i+=o}else if(Lt&c){const o=(c&(F|V))===0,a=new S(p(r,i),null,(c&V)===V?s.readLeftID():null,null,(c&F)===F?s.readRightID():null,o?s.readParentInfo()?s.readString():s.readLeftID():null,o&&(c&et)===et?s.readString():null,pn(s,c));yield a,i+=a.length}else{const o=s.readLen();yield new C(p(r,i),o),i+=o}}}}class ce{constructor(t,e){this.gen=os(t),this.curr=null,this.done=!1,this.filterSkips=e,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===E);return this.curr}}class oe{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const hs=s=>yt(s,Be,ht),as=(s,t)=>{if(s.constructor===C){const{client:e,clock:n}=s.id;return new C(p(e,n+t),s.length-t)}else if(s.constructor===E){const{client:e,clock:n}=s.id;return new E(p(e,n+t),s.length-t)}else{const e=s,{client:n,clock:r}=e.id;return new S(p(n,r+t),null,p(n,r+t-1),null,e.rightOrigin,e.parent,e.parentSub,e.content.splice(t))}},yt=(s,t=X,e=J)=>{if(s.length===1)return s[0];const n=s.map(h=>new t(Z(h)));let r=n.map(h=>new ce(h,!0)),i=null;const l=new e,c=new oe(l);for(;r=r.filter(u=>u.curr!==null),r.sort((u,f)=>{if(u.curr.id.client===f.curr.id.client){const g=u.curr.id.clock-f.curr.id.clock;return g===0?u.curr.constructor===f.curr.constructor?0:u.curr.constructor===E?1:-1:g}else return f.curr.id.client-u.curr.id.client}),r.length!==0;){const h=r[0],d=h.curr.id.client;if(i!==null){let u=h.curr,f=!1;for(;u!==null&&u.id.clock+u.length<=i.struct.id.clock+i.struct.length&&u.id.client>=i.struct.id.client;)u=h.next(),f=!0;if(u===null||u.id.client!==d||f&&u.id.clock>i.struct.id.clock+i.struct.length)continue;if(d!==i.struct.id.client)R(c,i.struct,i.offset),i={struct:u,offset:0},h.next();else if(i.struct.id.clock+i.struct.length<u.id.clock)if(i.struct.constructor===E)i.struct.length=u.id.clock+u.length-i.struct.id.clock;else{R(c,i.struct,i.offset);const g=u.id.clock-i.struct.id.clock-i.struct.length;i={struct:new E(p(d,i.struct.id.clock+i.struct.length),g),offset:0}}else{const g=i.struct.id.clock+i.struct.length-u.id.clock;g>0&&(i.struct.constructor===E?i.struct.length-=g:u=as(u,g)),i.struct.mergeWith(u)||(R(c,i.struct,i.offset),i={struct:u,offset:0},h.next())}}else i={struct:h.curr,offset:0},h.next();for(let u=h.curr;u!==null&&u.id.client===d&&u.id.clock===i.struct.id.clock+i.struct.length&&u.constructor!==E;u=h.next())R(c,i.struct,i.offset),i={struct:u,offset:0}}i!==null&&(R(c,i.struct,i.offset),i=null),he(c);const o=n.map(h=>ie(h)),a=Bn(o);return P(l,a),l.toUint8Array()},ds=(s,t,e=X,n=J)=>{const r=Ge(t),i=new n,l=new oe(i),c=new e(Z(s)),o=new ce(c,!1);for(;o.curr;){const h=o.curr,d=h.id.client,u=r.get(d)||0;if(o.curr.constructor===E){o.next();continue}if(h.id.clock+h.length>u)for(R(l,h,lt(u-h.id.clock,0)),o.next();o.curr&&o.curr.id.client===d;)R(l,o.curr,0),o.next();else for(;o.curr&&o.curr.id.client===d&&o.curr.id.clock+o.curr.length<=u;)o.next()}he(l);const a=ie(c);return P(i,a),i.toUint8Array()},Qe=s=>{s.written>0&&(s.clientStructs.push({written:s.written,restEncoder:N(s.encoder.restEncoder)}),s.encoder.restEncoder=Mt(),s.written=0)},R=(s,t,e)=>{s.written>0&&s.currClient!==t.id.client&&Qe(s),s.written===0&&(s.currClient=t.id.client,s.encoder.writeClient(t.id.client),m(s.encoder.restEncoder,t.id.clock+e)),t.write(s.encoder,e),s.written++},he=s=>{Qe(s);const t=s.encoder.restEncoder;m(t,s.clientStructs.length);for(let e=0;e<s.clientStructs.length;e++){const n=s.clientStructs[e];m(t,n.written),Re(t,n.restEncoder)}},us=(s,t,e,n)=>{const r=new e(Z(s)),i=new ce(r,!1),l=new n,c=new oe(l);for(let a=i.curr;a!==null;a=i.next())R(c,t(a),0);he(c);const o=ie(r);return P(l,o),l.toUint8Array()},fs=s=>us(s,Ln,X,ht),Ie="You must not compute changes after the event-handler fired.";class Tt{constructor(t,e){this.target=t,this.currentTarget=t,this.transaction=e,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=gs(this.currentTarget,this.target))}deletes(t){return Ne(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw mt(Ie);const t=new Map,e=this.target;this.transaction.changed.get(e).forEach(r=>{if(r!==null){const i=e._map.get(r);let l,c;if(this.adds(i)){let o=i.left;for(;o!==null&&this.adds(o);)o=o.left;if(this.deletes(i))if(o!==null&&this.deletes(o))l="delete",c=Ut(o.content.getContent());else return;else o!==null&&this.deletes(o)?(l="update",c=Ut(o.content.getContent())):(l="add",c=void 0)}else if(this.deletes(i))l="delete",c=Ut(i.content.getContent());else return;t.set(r,{action:l,oldValue:c})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw mt(Ie);const e=this.target,n=_t(),r=_t(),i=[];if(t={added:n,deleted:r,delta:i,keys:this.keys},this.transaction.changed.get(e).has(null)){let c=null;const o=()=>{c&&i.push(c)};for(let a=e._start;a!==null;a=a.right)a.deleted?this.deletes(a)&&!this.adds(a)&&((c===null||c.delete===void 0)&&(o(),c={delete:0}),c.delete+=a.length,r.add(a)):this.adds(a)?((c===null||c.insert===void 0)&&(o(),c={insert:[]}),c.insert=c.insert.concat(a.content.getContent()),n.add(a)):((c===null||c.retain===void 0)&&(o(),c={retain:0}),c.retain+=a.length);c!==null&&c.retain===void 0&&o()}this._changes=t}return t}}const gs=(s,t)=>{const e=[];for(;t._item!==null&&t!==s;){if(t._item.parentSub!==null)e.unshift(t._item.parentSub);else{let n=0,r=t._item.parent._start;for(;r!==t._item&&r!==null;)r.deleted||n++,r=r.right;e.unshift(n)}t=t._item.parent}return e},Ze=80;let ae=0;class ps{constructor(t,e){t.marker=!0,this.p=t,this.index=e,this.timestamp=ae++}}const ws=s=>{s.timestamp=ae++},Pe=(s,t,e)=>{s.p.marker=!1,s.p=t,t.marker=!0,s.index=e,s.timestamp=ae++},ks=(s,t,e)=>{if(s.length>=Ze){const n=s.reduce((r,i)=>r.timestamp<i.timestamp?r:i);return Pe(n,t,e),n}else{const n=new ps(t,e);return s.push(n),n}},xt=(s,t)=>{if(s._start===null||t===0||s._searchMarker===null)return null;const e=s._searchMarker.length===0?null:s._searchMarker.reduce((i,l)=>Bt(t-i.index)<Bt(t-l.index)?i:l);let n=s._start,r=0;for(e!==null&&(n=e.p,r=e.index,ws(e));n.right!==null&&r<t;){if(!n.deleted&&n.countable){if(t<r+n.length)break;r+=n.length}n=n.right}for(;n.left!==null&&r>t;)n=n.left,!n.deleted&&n.countable&&(r-=n.length);for(;n.left!==null&&n.left.id.client===n.id.client&&n.left.id.clock+n.left.length===n.id.clock;)n=n.left,!n.deleted&&n.countable&&(r-=n.length);return e!==null&&Bt(e.index-r)<n.parent.length/Ze?(Pe(e,n,r),e):ks(s._searchMarker,n,r)},nt=(s,t,e)=>{for(let n=s.length-1;n>=0;n--){const r=s[n];if(e>0){let i=r.p;for(i.marker=!1;i&&(i.deleted||!i.countable);)i=i.left,i&&!i.deleted&&i.countable&&(r.index-=i.length);if(i===null||i.marker===!0){s.splice(n,1);continue}r.p=i,i.marker=!0}(t<r.index||e>0&&t===r.index)&&(r.index=lt(t,r.index+e))}},Rt=(s,t,e)=>{const n=s,r=t.changedParentTypes;for(;G(r,s,()=>[]).push(e),s._item!==null;)s=s._item.parent;$e(n._eH,e,t)};class D{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=ye(),this._dEH=ye(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,e){this.doc=t,this._item=e}_copy(){throw M()}clone(){throw M()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,e){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){be(this._eH,t)}observeDeep(t){be(this._dEH,t)}unobserve(t){De(this._eH,t)}unobserveDeep(t){De(this._dEH,t)}toJSON(){}}const tn=(s,t,e)=>{t<0&&(t=s._length+t),e<0&&(e=s._length+e);let n=e-t;const r=[];let i=s._start;for(;i!==null&&n>0;){if(i.countable&&!i.deleted){const l=i.content.getContent();if(l.length<=t)t-=l.length;else{for(let c=t;c<l.length&&n>0;c++)r.push(l[c]),n--;t=0}}i=i.right}return r},en=s=>{const t=[];let e=s._start;for(;e!==null;){if(e.countable&&!e.deleted){const n=e.content.getContent();for(let r=0;r<n.length;r++)t.push(n[r])}e=e.right}return t},st=(s,t)=>{let e=0,n=s._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let i=0;i<r.length;i++)t(r[i],e++,s)}n=n.right}},nn=(s,t)=>{const e=[];return st(s,(n,r)=>{e.push(t(n,r,s))}),e},ms=s=>{let t=s._start,e=null,n=0;return{[Symbol.iterator](){return this},next:()=>{if(e===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};e=t.content.getContent(),n=0,t=t.right}const r=e[n++];return e.length<=n&&(e=null),{done:!1,value:r}}}},sn=(s,t)=>{const e=xt(s,t);let n=s._start;for(e!==null&&(n=e.p,t-=e.index);n!==null;n=n.right)if(!n.deleted&&n.countable){if(t<n.length)return n.content.getContent()[t];t-=n.length}},bt=(s,t,e,n)=>{let r=e;const i=s.doc,l=i.clientID,c=i.store,o=e===null?t._start:e.right;let a=[];const h=()=>{a.length>0&&(r=new S(p(l,y(c,l)),r,r&&r.lastId,o,o&&o.id,t,null,new H(a)),r.integrate(s,0),a=[])};n.forEach(d=>{if(d===null)a.push(d);else switch(d.constructor){case Number:case Object:case Boolean:case Array:case String:a.push(d);break;default:switch(h(),d.constructor){case Uint8Array:case ArrayBuffer:r=new S(p(l,y(c,l)),r,r&&r.lastId,o,o&&o.id,t,null,new at(new Uint8Array(d))),r.integrate(s,0);break;case ot:r=new S(p(l,y(c,l)),r,r&&r.lastId,o,o&&o.id,t,null,new dt(d)),r.integrate(s,0);break;default:if(d instanceof D)r=new S(p(l,y(c,l)),r,r&&r.lastId,o,o&&o.id,t,null,new x(d)),r.integrate(s,0);else throw new Error("Unexpected content type in insert operation")}}}),h()},rn=()=>mt("Length exceeded!"),ln=(s,t,e,n)=>{if(e>t._length)throw rn();if(e===0)return t._searchMarker&&nt(t._searchMarker,e,n.length),bt(s,t,null,n);const r=e,i=xt(t,e);let l=t._start;for(i!==null&&(l=i.p,e-=i.index,e===0&&(l=l.prev,e+=l&&l.countable&&!l.deleted?l.length:0));l!==null;l=l.right)if(!l.deleted&&l.countable){if(e<=l.length){e<l.length&&v(s,p(l.id.client,l.id.clock+e));break}e-=l.length}return t._searchMarker&&nt(t._searchMarker,r,n.length),bt(s,t,l,n)},_s=(s,t,e)=>{let r=(t._searchMarker||[]).reduce((i,l)=>l.index>i.index?l:i,{index:0,p:t._start}).p;if(r)for(;r.right;)r=r.right;return bt(s,t,r,e)},cn=(s,t,e,n)=>{if(n===0)return;const r=e,i=n,l=xt(t,e);let c=t._start;for(l!==null&&(c=l.p,e-=l.index);c!==null&&e>0;c=c.right)!c.deleted&&c.countable&&(e<c.length&&v(s,p(c.id.client,c.id.clock+e)),e-=c.length);for(;n>0&&c!==null;)c.deleted||(n<c.length&&v(s,p(c.id.client,c.id.clock+n)),c.delete(s),n-=c.length),c=c.right;if(n>0)throw rn();t._searchMarker&&nt(t._searchMarker,r,-i+n)},Dt=(s,t,e)=>{const n=t._map.get(e);n!==void 0&&n.delete(s)},de=(s,t,e,n)=>{const r=t._map.get(e)||null,i=s.doc,l=i.clientID;let c;if(n==null)c=new H([n]);else switch(n.constructor){case Number:case Object:case Boolean:case Array:case String:c=new H([n]);break;case Uint8Array:c=new at(n);break;case ot:c=new dt(n);break;default:if(n instanceof D)c=new x(n);else throw new Error("Unexpected content type")}new S(p(l,y(i.store,l)),r,r&&r.lastId,null,null,t,e,c).integrate(s,0)},ue=(s,t)=>{const e=s._map.get(t);return e!==void 0&&!e.deleted?e.content.getContent()[e.length-1]:void 0},on=s=>{const t={};return s._map.forEach((e,n)=>{e.deleted||(t[n]=e.content.getContent()[e.length-1])}),t},hn=(s,t)=>{const e=s._map.get(t);return e!==void 0&&!e.deleted},Ss=(s,t)=>{const e={};return s._map.forEach((n,r)=>{let i=n;for(;i!==null&&(!t.sv.has(i.id.client)||i.id.clock>=(t.sv.get(i.id.client)||0));)i=i.left;i!==null&&K(i,t)&&(e[r]=i.content.getContent()[i.length-1])}),e},gt=s=>Vn(s.entries(),t=>!t[1].deleted);class ys extends Tt{constructor(t,e){super(t,e),this._transaction=e}}class z extends D{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const e=new z;return e.push(t),e}_integrate(t,e){super._integrate(t,e),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new z}clone(){const t=new z;return t.insert(0,this.toArray().map(e=>e instanceof D?e.clone():e)),t}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(t,e){super._callObserver(t,e),Rt(this,t,new ys(this,t))}insert(t,e){this.doc!==null?_(this.doc,n=>{ln(n,this,t,e)}):this._prelimContent.splice(t,0,...e)}push(t){this.doc!==null?_(this.doc,e=>{_s(e,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,e=1){this.doc!==null?_(this.doc,n=>{cn(n,this,t,e)}):this._prelimContent.splice(t,e)}get(t){return sn(this,t)}toArray(){return en(this)}slice(t=0,e=this.length){return tn(this,t,e)}toJSON(){return this.map(t=>t instanceof D?t.toJSON():t)}map(t){return nn(this,t)}forEach(t){st(this,t)}[Symbol.iterator](){return ms(this)}_write(t){t.writeTypeRef($s)}}const bs=s=>new z;class Ds extends Tt{constructor(t,e,n){super(t,e),this.keysChanged=n}}class q extends D{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,e){super._integrate(t,e),this._prelimContent.forEach((n,r)=>{this.set(r,n)}),this._prelimContent=null}_copy(){return new q}clone(){const t=new q;return this.forEach((e,n)=>{t.set(n,e instanceof D?e.clone():e)}),t}_callObserver(t,e){Rt(this,t,new Ds(this,t,e))}toJSON(){const t={};return this._map.forEach((e,n)=>{if(!e.deleted){const r=e.content.getContent()[e.length-1];t[n]=r instanceof D?r.toJSON():r}}),t}get size(){return[...gt(this._map)].length}keys(){return Yt(gt(this._map),t=>t[0])}values(){return Yt(gt(this._map),t=>t[1].content.getContent()[t[1].length-1])}entries(){return Yt(gt(this._map),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this._map.forEach((e,n)=>{e.deleted||t(e.content.getContent()[e.length-1],n,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?_(this.doc,e=>{Dt(e,this,t)}):this._prelimContent.delete(t)}set(t,e){return this.doc!==null?_(this.doc,n=>{de(n,this,t,e)}):this._prelimContent.set(t,e),e}get(t){return ue(this,t)}has(t){return hn(this,t)}clear(){this.doc!==null?_(this.doc,t=>{this.forEach(function(e,n,r){Dt(t,r,n)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(Ks)}}const Cs=s=>new q,U=(s,t)=>s===t||typeof s=="object"&&typeof t=="object"&&s&&t&&En(s,t);class ee{constructor(t,e,n,r){this.left=t,this.right=e,this.index=n,this.currentAttributes=r}forward(){switch(this.right===null&&L(),this.right.content.constructor){case b:this.right.deleted||tt(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Le=(s,t,e)=>{for(;t.right!==null&&e>0;){switch(t.right.content.constructor){case b:t.right.deleted||tt(t.currentAttributes,t.right.content);break;default:t.right.deleted||(e<t.right.length&&v(s,p(t.right.id.client,t.right.id.clock+e)),t.index+=t.right.length,e-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},pt=(s,t,e)=>{const n=new Map,r=xt(t,e);if(r){const i=new ee(r.p.left,r.p,r.index,n);return Le(s,i,e-r.index)}else{const i=new ee(null,t._start,0,n);return Le(s,i,e)}},an=(s,t,e,n)=>{for(;e.right!==null&&(e.right.deleted===!0||e.right.content.constructor===b&&U(n.get(e.right.content.key),e.right.content.value));)e.right.deleted||n.delete(e.right.content.key),e.forward();const r=s.doc,i=r.clientID;n.forEach((l,c)=>{const o=e.left,a=e.right,h=new S(p(i,y(r.store,i)),o,o&&o.lastId,a,a&&a.id,t,null,new b(c,l));h.integrate(s,0),e.right=h,e.forward()})},tt=(s,t)=>{const{key:e,value:n}=t;n===null?s.delete(e):s.set(e,n)},dn=(s,t)=>{for(;s.right!==null;){if(!(s.right.deleted||s.right.content.constructor===b&&U(t[s.right.content.key]||null,s.right.content.value)))break;s.forward()}},un=(s,t,e,n)=>{const r=s.doc,i=r.clientID,l=new Map;for(const c in n){const o=n[c],a=e.currentAttributes.get(c)||null;if(!U(a,o)){l.set(c,a);const{left:h,right:d}=e;e.right=new S(p(i,y(r.store,i)),h,h&&h.lastId,d,d&&d.id,t,null,new b(c,o)),e.right.integrate(s,0),e.forward()}}return l},$t=(s,t,e,n,r)=>{e.currentAttributes.forEach((u,f)=>{r[f]===void 0&&(r[f]=null)});const i=s.doc,l=i.clientID;dn(e,r);const c=un(s,t,e,r),o=n.constructor===String?new T(n):n instanceof D?new x(n):new Y(n);let{left:a,right:h,index:d}=e;t._searchMarker&&nt(t._searchMarker,e.index,o.getLength()),h=new S(p(l,y(i.store,l)),a,a&&a.lastId,h,h&&h.id,t,null,o),h.integrate(s,0),e.right=h,e.index=d,e.forward(),an(s,t,e,c)},Me=(s,t,e,n,r)=>{const i=s.doc,l=i.clientID;dn(e,r);const c=un(s,t,e,r);t:for(;e.right!==null&&(n>0||c.size>0&&(e.right.deleted||e.right.content.constructor===b));){if(!e.right.deleted)switch(e.right.content.constructor){case b:{const{key:o,value:a}=e.right.content,h=r[o];if(h!==void 0){if(U(h,a))c.delete(o);else{if(n===0)break t;c.set(o,a)}e.right.delete(s)}else e.currentAttributes.set(o,a);break}default:n<e.right.length&&v(s,p(e.right.id.client,e.right.id.clock+n)),n-=e.right.length;break}e.forward()}if(n>0){let o="";for(;n>0;n--)o+=`
`;e.right=new S(p(l,y(i.store,l)),e.left,e.left&&e.left.lastId,e.right,e.right&&e.right.id,t,null,new T(o)),e.right.integrate(s,0),e.forward()}an(s,t,e,c)},fn=(s,t,e,n,r)=>{let i=t;const l=ne();for(;i&&(!i.countable||i.deleted);){if(!i.deleted&&i.content.constructor===b){const a=i.content;l.set(a.key,a)}i=i.right}let c=0,o=!1;for(;t!==i;){if(e===t&&(o=!0),!t.deleted){const a=t.content;switch(a.constructor){case b:{const{key:h,value:d}=a,u=n.get(h)||null;(l.get(h)!==a||u===d)&&(t.delete(s),c++,!o&&(r.get(h)||null)===d&&u!==d&&(u===null?r.delete(h):r.set(h,u))),!o&&!t.deleted&&tt(r,a);break}}}t=t.right}return c},Es=(s,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const e=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===b){const n=t.content.key;e.has(n)?t.delete(s):e.add(n)}t=t.left}},As=s=>{let t=0;return _(s.doc,e=>{let n=s._start,r=s._start,i=ne();const l=Wt(i);for(;r;){if(r.deleted===!1)switch(r.content.constructor){case b:tt(l,r.content);break;default:t+=fn(e,n,r,i,l),i=Wt(l),n=r;break}r=r.right}}),t},Is=s=>{const t=new Set,e=s.doc;for(const[n,r]of s.afterState.entries()){const i=s.beforeState.get(n)||0;r!==i&&Xe(s,e.store.clients.get(n),i,r,l=>{!l.deleted&&l.content.constructor===b&&l.constructor!==C&&t.add(l.parent)})}_(e,n=>{ve(s,s.deleteSet,r=>{if(r instanceof C||!r.parent._hasFormatting||t.has(r.parent))return;const i=r.parent;r.content.constructor===b?t.add(i):Es(n,r)});for(const r of t)As(r)})},Oe=(s,t,e)=>{const n=e,r=Wt(t.currentAttributes),i=t.right;for(;e>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case x:case Y:case T:e<t.right.length&&v(s,p(t.right.id.client,t.right.id.clock+e)),e-=t.right.length,t.right.delete(s);break}t.forward()}i&&fn(s,i,t.right,r,t.currentAttributes);const l=(t.left||t.right).parent;return l._searchMarker&&nt(l._searchMarker,t.index,-n+e),t};class Ls extends Tt{constructor(t,e,n){super(t,e),this.childListChanged=!1,this.keysChanged=new Set,n.forEach(r=>{r===null?this.childListChanged=!0:this.keysChanged.add(r)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,e=[];_(t,n=>{const r=new Map,i=new Map;let l=this.target._start,c=null;const o={};let a="",h=0,d=0;const u=()=>{if(c!==null){let f=null;switch(c){case"delete":d>0&&(f={delete:d}),d=0;break;case"insert":(typeof a=="object"||a.length>0)&&(f={insert:a},r.size>0&&(f.attributes={},r.forEach((g,w)=>{g!==null&&(f.attributes[w]=g)}))),a="";break;case"retain":h>0&&(f={retain:h},_n(o)||(f.attributes=Sn({},o))),h=0;break}f&&e.push(f),c=null}};for(;l!==null;){switch(l.content.constructor){case x:case Y:this.adds(l)?this.deletes(l)||(u(),c="insert",a=l.content.getContent()[0],u()):this.deletes(l)?(c!=="delete"&&(u(),c="delete"),d+=1):l.deleted||(c!=="retain"&&(u(),c="retain"),h+=1);break;case T:this.adds(l)?this.deletes(l)||(c!=="insert"&&(u(),c="insert"),a+=l.content.str):this.deletes(l)?(c!=="delete"&&(u(),c="delete"),d+=l.length):l.deleted||(c!=="retain"&&(u(),c="retain"),h+=l.length);break;case b:{const{key:f,value:g}=l.content;if(this.adds(l)){if(!this.deletes(l)){const w=r.get(f)||null;U(w,g)?g!==null&&l.delete(n):(c==="retain"&&u(),U(g,i.get(f)||null)?delete o[f]:o[f]=g)}}else if(this.deletes(l)){i.set(f,g);const w=r.get(f)||null;U(w,g)||(c==="retain"&&u(),o[f]=w)}else if(!l.deleted){i.set(f,g);const w=o[f];w!==void 0&&(U(w,g)?w!==null&&l.delete(n):(c==="retain"&&u(),g===null?delete o[f]:o[f]=g))}l.deleted||(c==="insert"&&u(),tt(r,l.content));break}}l=l.right}for(u();e.length>0;){const f=e[e.length-1];if(f.retain!==void 0&&f.attributes===void 0)e.pop();else break}}),this._delta=e}return this._delta}}class Q extends D{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this._length}_integrate(t,e){super._integrate(t,e);try{this._pending.forEach(n=>n())}catch(n){console.error(n)}this._pending=null}_copy(){return new Q}clone(){const t=new Q;return t.applyDelta(this.toDelta()),t}_callObserver(t,e){super._callObserver(t,e);const n=new Ls(this,t,e);Rt(this,t,n),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){let t="",e=this._start;for(;e!==null;)!e.deleted&&e.countable&&e.content.constructor===T&&(t+=e.content.str),e=e.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:e=!0}={}){this.doc!==null?_(this.doc,n=>{const r=new ee(null,this._start,0,new Map);for(let i=0;i<t.length;i++){const l=t[i];if(l.insert!==void 0){const c=!e&&typeof l.insert=="string"&&i===t.length-1&&r.right===null&&l.insert.slice(-1)===`
`?l.insert.slice(0,-1):l.insert;(typeof c!="string"||c.length>0)&&$t(n,this,r,c,l.attributes||{})}else l.retain!==void 0?Me(n,this,r,l.retain,l.attributes||{}):l.delete!==void 0&&Oe(n,r,l.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,e,n){const r=[],i=new Map,l=this.doc;let c="",o=this._start;function a(){if(c.length>0){const d={};let u=!1;i.forEach((g,w)=>{u=!0,d[w]=g});const f={insert:c};u&&(f.attributes=d),r.push(f),c=""}}const h=()=>{for(;o!==null;){if(K(o,t)||e!==void 0&&K(o,e))switch(o.content.constructor){case T:{const d=i.get("ychange");t!==void 0&&!K(o,t)?(d===void 0||d.user!==o.id.client||d.type!=="removed")&&(a(),i.set("ychange",n?n("removed",o.id):{type:"removed"})):e!==void 0&&!K(o,e)?(d===void 0||d.user!==o.id.client||d.type!=="added")&&(a(),i.set("ychange",n?n("added",o.id):{type:"added"})):d!==void 0&&(a(),i.delete("ychange")),c+=o.content.str;break}case x:case Y:{a();const d={insert:o.content.getContent()[0]};if(i.size>0){const u={};d.attributes=u,i.forEach((f,g)=>{u[g]=f})}r.push(d);break}case b:K(o,t)&&(a(),tt(i,o.content));break}o=o.right}a()};return t||e?_(l,d=>{t&&Pt(d,t),e&&Pt(d,e),h()},"cleanup"):h(),r}insert(t,e,n){if(e.length<=0)return;const r=this.doc;r!==null?_(r,i=>{const l=pt(i,this,t);n||(n={},l.currentAttributes.forEach((c,o)=>{n[o]=c})),$t(i,this,l,e,n)}):this._pending.push(()=>this.insert(t,e,n))}insertEmbed(t,e,n={}){const r=this.doc;r!==null?_(r,i=>{const l=pt(i,this,t);$t(i,this,l,e,n)}):this._pending.push(()=>this.insertEmbed(t,e,n))}delete(t,e){if(e===0)return;const n=this.doc;n!==null?_(n,r=>{Oe(r,pt(r,this,t),e)}):this._pending.push(()=>this.delete(t,e))}format(t,e,n){if(e===0)return;const r=this.doc;r!==null?_(r,i=>{const l=pt(i,this,t);l.right!==null&&Me(i,this,l,e,n)}):this._pending.push(()=>this.format(t,e,n))}removeAttribute(t){this.doc!==null?_(this.doc,e=>{Dt(e,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,e){this.doc!==null?_(this.doc,n=>{de(n,this,t,e)}):this._pending.push(()=>this.setAttribute(t,e))}getAttribute(t){return ue(this,t)}getAttributes(){return on(this)}_write(t){t.writeTypeRef(Ws)}}const Ms=s=>new Q;class Kt{constructor(t,e=()=>!0){this._filter=e,this._root=t,this._currentNode=t._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let t=this._currentNode,e=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(e)))do if(e=t.content.type,!t.deleted&&(e.constructor===rt||e.constructor===j)&&e._start!==null)t=e._start;else for(;t!==null;)if(t.right!==null){t=t.right;break}else t.parent===this._root?t=null:t=t.parent._item;while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class j extends D{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,e){super._integrate(t,e),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new j}clone(){const t=new j;return t.insert(0,this.toArray().map(e=>e instanceof D?e.clone():e)),t}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new Kt(this,t)}querySelector(t){t=t.toUpperCase();const n=new Kt(this,r=>r.nodeName&&r.nodeName.toUpperCase()===t).next();return n.done?null:n.value}querySelectorAll(t){return t=t.toUpperCase(),B(new Kt(this,e=>e.nodeName&&e.nodeName.toUpperCase()===t))}_callObserver(t,e){Rt(this,t,new xs(this,e,t))}toString(){return nn(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,e={},n){const r=t.createDocumentFragment();return n!==void 0&&n._createAssociation(r,this),st(this,i=>{r.insertBefore(i.toDOM(t,e,n),null)}),r}insert(t,e){this.doc!==null?_(this.doc,n=>{ln(n,this,t,e)}):this._prelimContent.splice(t,0,...e)}insertAfter(t,e){if(this.doc!==null)_(this.doc,n=>{const r=t&&t instanceof D?t._item:t;bt(n,this,r,e)});else{const n=this._prelimContent,r=t===null?0:n.findIndex(i=>i===t)+1;if(r===0&&t!==null)throw mt("Reference item not found");n.splice(r,0,...e)}}delete(t,e=1){this.doc!==null?_(this.doc,n=>{cn(n,this,t,e)}):this._prelimContent.splice(t,e)}toArray(){return en(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return sn(this,t)}slice(t=0,e=this.length){return tn(this,t,e)}forEach(t){st(this,t)}_write(t){t.writeTypeRef(Xs)}}const Os=s=>new j;class rt extends j{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,e){super._integrate(t,e),this._prelimAttrs.forEach((n,r)=>{this.setAttribute(r,n)}),this._prelimAttrs=null}_copy(){return new rt(this.nodeName)}clone(){const t=new rt(this.nodeName),e=this.getAttributes();return yn(e,(n,r)=>{typeof n=="string"&&t.setAttribute(r,n)}),t.insert(0,this.toArray().map(n=>n instanceof D?n.clone():n)),t}toString(){const t=this.getAttributes(),e=[],n=[];for(const c in t)n.push(c);n.sort();const r=n.length;for(let c=0;c<r;c++){const o=n[c];e.push(o+'="'+t[o]+'"')}const i=this.nodeName.toLocaleLowerCase(),l=e.length>0?" "+e.join(" "):"";return`<${i}${l}>${super.toString()}</${i}>`}removeAttribute(t){this.doc!==null?_(this.doc,e=>{Dt(e,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,e){this.doc!==null?_(this.doc,n=>{de(n,this,t,e)}):this._prelimAttrs.set(t,e)}getAttribute(t){return ue(this,t)}hasAttribute(t){return hn(this,t)}getAttributes(t){return t?Ss(this,t):on(this)}toDOM(t=document,e={},n){const r=t.createElement(this.nodeName),i=this.getAttributes();for(const l in i){const c=i[l];typeof c=="string"&&r.setAttribute(l,c)}return st(this,l=>{r.appendChild(l.toDOM(t,e,n))}),n!==void 0&&n._createAssociation(r,this),r}_write(t){t.writeTypeRef(zs),t.writeKey(this.nodeName)}}const Ts=s=>new rt(s.readKey());class xs extends Tt{constructor(t,e,n){super(t,n),this.childListChanged=!1,this.attributesChanged=new Set,e.forEach(r=>{r===null?this.childListChanged=!0:this.attributesChanged.add(r)})}}class Ct extends q{constructor(t){super(),this.hookName=t}_copy(){return new Ct(this.hookName)}clone(){const t=new Ct(this.hookName);return this.forEach((e,n)=>{t.set(n,e)}),t}toDOM(t=document,e={},n){const r=e[this.hookName];let i;return r!==void 0?i=r.createDom(this):i=document.createElement(this.hookName),i.setAttribute("data-yjs-hook",this.hookName),n!==void 0&&n._createAssociation(i,this),i}_write(t){t.writeTypeRef(qs),t.writeKey(this.hookName)}}const Rs=s=>new Ct(s.readKey());class Et extends Q{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new Et}clone(){const t=new Et;return t.applyDelta(this.toDelta()),t}toDOM(t=document,e,n){const r=t.createTextNode(this.toString());return n!==void 0&&n._createAssociation(r,this),r}toString(){return this.toDelta().map(t=>{const e=[];for(const r in t.attributes){const i=[];for(const l in t.attributes[r])i.push({key:l,value:t.attributes[r][l]});i.sort((l,c)=>l.key<c.key?-1:1),e.push({nodeName:r,attrs:i})}e.sort((r,i)=>r.nodeName<i.nodeName?-1:1);let n="";for(let r=0;r<e.length;r++){const i=e[r];n+=`<${i.nodeName}`;for(let l=0;l<i.attrs.length;l++){const c=i.attrs[l];n+=` ${c.key}="${c.value}"`}n+=">"}n+=t.insert;for(let r=e.length-1;r>=0;r--)n+=`</${e[r].nodeName}>`;return n}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(Qs)}}const Us=s=>new Et;class fe{constructor(t,e){this.id=t,this.length=e}get deleted(){throw M()}mergeWith(t){return!1}write(t,e,n){throw M()}integrate(t,e){throw M()}}const vs=0;class C extends fe{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,e){e>0&&(this.id.clock+=e,this.length-=e),ze(t.doc.store,this)}write(t,e){t.writeInfo(vs),t.writeLen(this.length-e)}getMissing(t,e){return null}}class at{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new at(this.content)}splice(t){throw M()}mergeWith(t){return!1}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeBuf(this.content)}getRef(){return 3}}const Ns=s=>new at(s.readBuf());class it{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new it(this.len)}splice(t){const e=new it(this.len-t);return this.len=t,e}mergeWith(t){return this.len+=t.len,!0}integrate(t,e){St(t.deleteSet,e.id.client,e.id.clock,this.len),e.markDeleted()}delete(t){}gc(t){}write(t,e){t.writeLen(this.len-e)}getRef(){return 1}}const Vs=s=>new it(s.readLen()),gn=(s,t)=>new ot({guid:s,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class dt{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const e={};this.opts=e,t.gc||(e.gc=!1),t.autoLoad&&(e.autoLoad=!0),t.meta!==null&&(e.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new dt(gn(this.doc.guid,this.opts))}splice(t){throw M()}mergeWith(t){return!1}integrate(t,e){this.doc._item=e,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,e){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const Fs=s=>new dt(gn(s.readString(),s.readAny()));class Y{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Y(this.embed)}splice(t){throw M()}mergeWith(t){return!1}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeJSON(this.embed)}getRef(){return 5}}const Bs=s=>new Y(s.readJSON());class b{constructor(t,e){this.key=t,this.value=e}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new b(this.key,this.value)}splice(t){throw M()}mergeWith(t){return!1}integrate(t,e){const n=e.parent;n._searchMarker=null,n._hasFormatting=!0}delete(t){}gc(t){}write(t,e){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const Js=s=>new b(s.readKey(),s.readJSON());class At{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new At(this.arr)}splice(t){const e=new At(this.arr.slice(t));return this.arr=this.arr.slice(0,t),e}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){const n=this.arr.length;t.writeLen(n-e);for(let r=e;r<n;r++){const i=this.arr[r];t.writeString(i===void 0?"undefined":JSON.stringify(i))}}getRef(){return 2}}const js=s=>{const t=s.readLen(),e=[];for(let n=0;n<t;n++){const r=s.readString();r==="undefined"?e.push(void 0):e.push(JSON.parse(r))}return new At(e)};class H{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new H(this.arr)}splice(t){const e=new H(this.arr.slice(t));return this.arr=this.arr.slice(0,t),e}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){const n=this.arr.length;t.writeLen(n-e);for(let r=e;r<n;r++){const i=this.arr[r];t.writeAny(i)}}getRef(){return 8}}const Hs=s=>{const t=s.readLen(),e=[];for(let n=0;n<t;n++)e.push(s.readAny());return new H(e)};class T{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new T(this.str)}splice(t){const e=new T(this.str.slice(t));this.str=this.str.slice(0,t);const n=this.str.charCodeAt(t-1);return n>=55296&&n<=56319&&(this.str=this.str.slice(0,t-1)+"�",e.str="�"+e.str.slice(1)),e}mergeWith(t){return this.str+=t.str,!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeString(e===0?this.str:this.str.slice(e))}getRef(){return 4}}const Gs=s=>new T(s.readString()),Ys=[bs,Cs,Ms,Ts,Os,Rs,Us],$s=0,Ks=1,Ws=2,zs=3,Xs=4,qs=5,Qs=6;class x{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new x(this.type._copy())}splice(t){throw M()}mergeWith(t){return!1}integrate(t,e){this.type._integrate(t.doc,e)}delete(t){let e=this.type._start;for(;e!==null;)e.deleted?e.id.clock<(t.beforeState.get(e.id.client)||0)&&t._mergeStructs.push(e):e.delete(t),e=e.right;this.type._map.forEach(n=>{n.deleted?n.id.clock<(t.beforeState.get(n.id.client)||0)&&t._mergeStructs.push(n):n.delete(t)}),t.changed.delete(this.type)}gc(t){let e=this.type._start;for(;e!==null;)e.gc(t,!0),e=e.right;this.type._start=null,this.type._map.forEach(n=>{for(;n!==null;)n.gc(t,!0),n=n.left}),this.type._map=new Map}write(t,e){this.type._write(t)}getRef(){return 7}}const Zs=s=>new x(Ys[s.readTypeRef()](s)),Te=(s,t)=>{let e=t,n=0,r;do n>0&&(e=p(e.client,e.clock+n)),r=wt(s,e),n=e.clock-r.id.clock,e=r.redone;while(e!==null&&r instanceof S);return{item:r,diff:n}},It=(s,t,e)=>{const{client:n,clock:r}=t.id,i=new S(p(n,r+e),t,p(n,r+e-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(e));return t.deleted&&i.markDeleted(),t.keep&&(i.keep=!0),t.redone!==null&&(i.redone=p(t.redone.client,t.redone.clock+e)),t.right=i,i.right!==null&&(i.right.left=i),s._mergeStructs.push(i),i.parentSub!==null&&i.right===null&&i.parent._map.set(i.parentSub,i),t.length=e,i};class S extends fe{constructor(t,e,n,r,i,l,c,o){super(t,o.getLength()),this.origin=n,this.left=e,this.right=r,this.rightOrigin=i,this.parent=l,this.parentSub=c,this.redone=null,this.content=o,this.info=this.content.isCountable()?pe:0}set marker(t){(this.info&vt)>0!==t&&(this.info^=vt)}get marker(){return(this.info&vt)>0}get keep(){return(this.info&we)>0}set keep(t){this.keep!==t&&(this.info^=we)}get countable(){return(this.info&pe)>0}get deleted(){return(this.info&Nt)>0}set deleted(t){this.deleted!==t&&(this.info^=Nt)}markDeleted(){this.info|=Nt}getMissing(t,e){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=y(e,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=y(e,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===W&&this.id.client!==this.parent.client&&this.parent.clock>=y(e,this.parent.client))return this.parent.client;if(this.origin&&(this.left=Ce(t,e,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=v(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===C||this.right&&this.right.constructor===C)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===S&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===S&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===W){const n=wt(e,this.parent);n.constructor===C?this.parent=null:this.parent=n.content.type}return null}integrate(t,e){if(e>0&&(this.id.clock+=e,this.left=Ce(t,t.doc.store,p(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(e),this.length-=e),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let n=this.left,r;if(n!==null)r=n.right;else if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start;const i=new Set,l=new Set;for(;r!==null&&r!==this.right;){if(l.add(r),i.add(r),ut(this.origin,r.origin)){if(r.id.client<this.id.client)n=r,i.clear();else if(ut(this.rightOrigin,r.rightOrigin))break}else if(r.origin!==null&&l.has(wt(t.doc.store,r.origin)))i.has(wt(t.doc.store,r.origin))||(n=r,i.clear());else break;r=r.right}this.left=n}if(this.left!==null){const n=this.left.right;this.right=n,this.left.right=this}else{let n;if(this.parentSub!==null)for(n=this.parent._map.get(this.parentSub)||null;n!==null&&n.left!==null;)n=n.left;else n=this.parent._start,this.parent._start=this;this.right=n}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),ze(t.doc.store,this),this.content.integrate(t,this),Ae(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new C(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:p(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&ut(t.origin,this.lastId)&&this.right===t&&ut(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const e=this.parent._searchMarker;return e&&e.forEach(n=>{n.p===t&&(n.p=this,!this.deleted&&this.countable&&(n.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const e=this.parent;this.countable&&this.parentSub===null&&(e._length-=this.length),this.markDeleted(),St(t.deleteSet,this.id.client,this.id.clock,this.length),Ae(t,e,this.parentSub),this.content.delete(t)}}gc(t,e){if(!this.deleted)throw L();this.content.gc(t),e?rs(t,this,new C(this.id,this.length)):this.content=new it(this.length)}write(t,e){const n=e>0?p(this.id.client,this.id.clock+e-1):this.origin,r=this.rightOrigin,i=this.parentSub,l=this.content.getRef()&Lt|(n===null?0:V)|(r===null?0:F)|(i===null?0:et);if(t.writeInfo(l),n!==null&&t.writeLeftID(n),r!==null&&t.writeRightID(r),n===null&&r===null){const c=this.parent;if(c._item!==void 0){const o=c._item;if(o===null){const a=Ke(c);t.writeParentInfo(!0),t.writeString(a)}else t.writeParentInfo(!1),t.writeLeftID(o.id)}else c.constructor===String?(t.writeParentInfo(!0),t.writeString(c)):c.constructor===W?(t.writeParentInfo(!1),t.writeLeftID(c)):L();i!==null&&t.writeString(i)}this.content.write(t,e)}}const pn=(s,t)=>Ps[t&Lt](s),Ps=[()=>{L()},Vs,js,Ns,Gs,Bs,Js,Zs,Hs,Fs,()=>{L()}],tr=10;class E extends fe{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,e){L()}write(t,e){t.writeInfo(tr),m(t.restEncoder,this.length-e)}getMissing(t,e){return null}}const wn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof ge<"u"?ge:{},kn="__ $YJS$ __";wn[kn]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");wn[kn]=!0;export{ot as D,cr as a,ir as b,or as c,rr as d,lr as e};
